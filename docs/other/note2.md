# 性能优化

1. 通过DNS缓存机制减少DNS的查询次数。
    1. 为了提升域名查询效率，设计了域名缓存机制，当访问过某个网站并得到其IP后，会将其域名和IP缓存下来，下次访问时就不需要再次请求域名服务器获取IP，直接使用缓存中的IP，提高响应速度。
    2. 浏览器缓存，操作系统（OS）缓存，传统递归DNS服务器。浏览器访问时会优先浏览器缓存，如果未命中则访问OS缓存，最后在访问递归DNS服务器查找域名记录，然后返回结果。
2. 减少http请求。
    1. 合并css和js资源。
    2. 小图片图标使用css精灵图，base64方式（注意DataURL图片不会进行压缩，也文件会变大，加载耗时）。
    3. 优先使用css3的特性代替图片资源，比如阴影动效等。
    4. 使用字体图标替代图片图标。
    5. 避免空的src和href。
    6. 以上这些大多webpack已经帮助解决。
    7. 缓存资源，Ajax使用get请求。
3. 使用http2。
    1. 解析速度快。
    2. 多路复用。http1.1同时发起多个请求就得建立多个TCP连接，因为一个TCP连接同时只能处理一个http1.1的请求。在http2上，多个请求可以共用一个TCP连接，同一个请求和响应用一个流来表示，并有唯一的流ID来标识。多个请求和响应在TCP连接中可以乱序发送，到达目的地后再通过流ID重新组建。
    3. 首部压缩。可以把相同的首部存起来，仅发送不同的部分，可以节省流量加快请求时间。http2在客户端和服务端使用“首部表”来跟踪和存储之前发送的键值对，对于相同的数据，不再通过请求发送。当客户端发送请求时，会根据首部创建一张表，如果服务器收到请求也会创建一张表，当客户端发送下一个请求时如果首部相同，可以直击发送表相应的键索引，服务器会查找先前建立的表，并把这些索引还原成完整首部。
    4. 服务器推送。服务器可以对一个客户端请求发送多个响应，意思就是服务器可以额外向客户端提前推送资源，而无需客户端明确请求。
4. 静态资源使用CDN。
5. 压缩代码。
    1. 构建工具代码压缩。
    2. http请求头中的Accept-Encoding设置gzip。
    3. 服务器端设置gzip等方式减少传输文件体积。
6. 减少阻塞。
    1. 样式资源使用link方式引入，避免使用@import导入样式表，因为@import会在页面加载完毕后被加载。
    2. js文件放在底部（script标签会阻塞渲染并停止html解析），如果非要放在头部，script元素属性设置defer或async进行异步加载，延迟执行。（defer顺序执行，async乱序执行）。
7. 减少浏览器重绘回流。
    1. 减少DOM元素数量，减少不必要的标签嵌套，标签更加扁平化，语义化。
    2. 尽量避遍DOM操作。当改变DOM元素或者大小时，会导致浏览器重新生成渲染树（回流），渲染树的改变会将渲染树的每个节点重新绘制到屏幕（重绘）。回流会导致重绘，重绘不会导致回流。这两个操作都非常昂贵。
    3. 用js修改样式时，最好不要直接写样式，用class。
    4. 导致回流的操作有（添加或删除DOM，改变元素位置尺寸，改变内容，浏览器窗口尺寸变动）。
    5. 使用flex布局，避免使用float（渲染计算量比较大）。
    6. 定义图片大小，避免重绘。
    7. 尽可能在DOM树的末端改变class。
8. 降低css选择器的复杂性
    1. 浏览器读取选择器原则从右到左，所以尽量为标签增加class。
    2. 其实选择器没有优化的必要，因为性能差别非常微小。
    3. 避免使用css表达式。
9. 首屏加载，提升用户对页面速度的感知。
    1. 比如骨架图。
    2. 按需加载（按需加载会导致大量重绘，影响渲染性能）。
    3. 预加载。
    4. 不在HTML中缩放图片。
10. 减少Cookie，使用无cookie的域名。
11. 避免重定向。
12. 优化js高频事件。
    1. 函数节流防抖。resize，scroll，鼠标事件，input的keypress等会不断的调用绑定在事件上回调函数，需要对这类事件进行调用次数限制。
13. GPU加速，使用某些HTML5标签和CSS3属性会触发GPU渲染。
    1. html标签（video，canvas）。
    2. css属性（opacity，transform，transition）。
    3. 将内容提升到GPU层（而不是CPU上的主线程）虽然可以提高绘制性能，但是是以内存管理为代价，因此不能过度使用。


> [参考](https://mp.weixin.qq.com/s/ezOX9lcLEOuMjlRIrT_ARw)